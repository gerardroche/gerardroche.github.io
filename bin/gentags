#!/bin/sh

set -e
unset CDPATH
unset IFS

TAGS=""

for post in _posts/*.md; do
    tags="$(grep "tags: " "$post" | sed 's/^tags: //')"
    for tag in $tags; do
        TAGS="$TAGS\n$tag"
    done

    TAGS="$(echo "$TAGS" | sort -u)"
done

for tag in $TAGS; do
    tag_file="_archive-tags/$tag.html"
    test ! -f "$tag_file" || continue
    echo "---\nlayout: tag\nlast_modified_at: $(date +%Y-%m-%dT%H:%M:%S%:z)\n---" > "$tag_file"
    echo "Generated new tag file: $tag_file"
    # TODO if new tag is generated update the last modified at for index tags.html page
done
